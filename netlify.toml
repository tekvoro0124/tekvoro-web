[build]
  command = "npm run build"
  functions = "netlify/functions"
  publish = "dist"

  [build.environment]
    NODE_ENV = "production"

[dev]
  command = "npm run dev"
  port = 5173
  publish = "dist"
  functions = "netlify/functions"

[context.production.environment]
  SENDGRID_API_KEY = "your-sendgrid-api-key"
  EMAIL_FROM_ADDRESS = "info@tekvoro.com"
  EMAIL_REPLY_TO = "info@tekvoro.com"

[context.deploy-preview.environment]
  SENDGRID_API_KEY = "your-sendgrid-api-key"
  EMAIL_FROM_ADDRESS = "info@tekvoro.com"
  EMAIL_REPLY_TO = "info@tekvoro.com"

# ✅ STEP 1 — Specific Netlify Functions FIRST
[[redirects]]
  from = "/api/book-demo"
  to = "/.netlify/functions/book-demo"
  status = 200
  force = true

[[redirects]]
  from = "/api/subscribe"
  to = "/.netlify/functions/subscribe"
  status = 200
  force = true

[[redirects]]
  from = "/api/ai-search"
  to = "/.netlify/functions/ai-search"
  status = 200
  force = true

[[redirects]]
  from = "/api/send-email"
  to = "/.netlify/functions/send-email"
  status = 200
  force = true

[[redirects]]
  from = "/api/email-track/*"
  to = "/.netlify/functions/email-track/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/api/email-click/*"
  to = "/.netlify/functions/email-track/:splat"
  status = 200
  force = true

[[redirects]]
  from = "/api/email-analytics"
  to = "/.netlify/functions/email-analytics"
  status = 200
  force = true

[[redirects]]
  from = "/api/email-templates"
  to = "/.netlify/functions/email-templates"
  status = 200
  force = true

[[redirects]]
  from = "/api/test-sendgrid-domain"
  to = "/.netlify/functions/test-sendgrid-domain"
  status = 200
  force = true

# ✅ STEP 2 — General API proxy to Railway SECOND
[[redirects]]
  from = "/api/*"
  to = "https://tekvoro-production.up.railway.app/api/:splat"
  status = 200
  force = true

# ✅ STEP 3 — SPA catch-all ALWAYS LAST
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200